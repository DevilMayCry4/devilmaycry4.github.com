<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>無限大な夢</title>
  <meta name="author" content="virgil">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="無限大な夢"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="無限大な夢" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">無限大な夢</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-11-19T05:24:33.000Z"><a href="/2014/11/19/使用python编译ipa，并上传到FTP/">Nov 19 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/11/19/使用python编译ipa，并上传到FTP/">使用python编译ipa，并上传到FTP</a></h1>
  

    </header>
    <div class="entry">
      
        <p><br>人工发布版本需要archive完之后、拖到itunes里、再把ipa上传到FTP上、费时费力、下面的这个python脚本可以自动完成这些工作、而且完成的时候、发出通知、并把ipa的ftp地址放到粘贴板里。<br><a href="https://github.com/DevilMayCry4/python/blob/master/build.py" target="_blank" rel="external">脚本地址</a><br></p><p><br><br></p><p><br>这个脚本只需要设置<br>DefaultProjectDir:默认的工程文件所在文件夹,或者工程文件的路径。<br>OutPutDir：#ipa 文件输出的文件夹<br>还有些ftp的设置<br>ipa的名字是productname+.月+.日<br>如果输出文件夹已经有该名字，会在后面加上数字、依次递增<br></p>

<p><br>可以在终端中执行这个脚本、这个脚本可以接收程文件所在文件夹,或者工程文件的路径的参数，如果没有使用默认的路径。形如：python /users/user/build.py /users/user/documents/project<br></p><br><p><br>也可以给这个脚本执行的权限、就不用写得这么复杂，<br>先执行:chmod +x  /users/user/build.py<br>在添加环境变量：vim .profile<br>加上 export PATH=/users/user/build.py:$PATH<br>执行的时候使用：./build.py  /users/user/documents/project<br></p>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-04-23T08:17:59.000Z"><a href="/2014/04/23/IOS/openfire/">Apr 23 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/04/23/IOS/openfire/">OpenFire</a></h1>
  

    </header>
    <div class="entry">
      
        <p>先到<a href="http://dev.mysql.com/downloads/mysql" target="_blank" rel="external">http://dev.mysql.com/downloads/mysql</a>下载对应的mysql版本。<br>安装并启动mysql、</p>
<p>二、打开终端，定义mysql别名</p><br><p>输入alias命令</p><br><pre>alias mysql=/usr/local/mysql/bin/mysql</pre><br><p>回车，再输入</p><br><pre>alias mysqladmin=/usr/local/mysql/bin/mysqladmin</pre><br><p>三、设置mysql root帐号的密码</p><br><pre>mysqladmin -u root password 初始密码</pre><br><br><p>2.如果设置完密码后，需要修改，执行命令</p><br><pre>mysqladmin -u root -p  password 最新密码</pre><br><br><p>接着会提示输入密码，此时输入旧密码，回车</p><br><p>&nbsp;四、连接数据库</p><br><pre>mysql -u root -p</pre><br><br><p>然后提示输入密码，输入三中设置的初始密码</p><br><p>2.如果登陆远程主机上的mysql数据库</p><br><pre>mysql -h 主机地址 -u 用户名 -p 用户密码</pre><br><br><p>&nbsp;</p><br><p>五、执行常用的mysql数据库操作</p><br><p>注意：以下操作都发现在，连接数据库之后，进入mysql环境，之后执行的命令都必须带有分号&ldquo;;&rdquo;</p><br><p>首先，以root权限连接mysql</p><br><pre>mysql -u root -p</pre><br><br><p>然后，输入root的密码</p>

<p></p><p>1、增加新用户</p><p></p>
<p></p><p>格式如下：</p><p></p>
<pre>grant 操作权限 on 数据库.* to 用户名@登陆主机地址 identified by <span style="color: #800000;">'</span><span style="color: #800000;">密码</span><span style="color: #800000;">';</span></pre>

<p></p><p>意思是：授予，某主机上的某用户（附带该用户的登陆密码）在某数据库上，执行某些操作的权限</p><p></p>
<p></p><p>(1)比如：任意主机上(“%”)，用户（用户名：test1，密码：adc）在所有数据库上，执行任意操作的权限（很危险）</p><p></p>
<pre>grant all privileges on *.* to test1<span style="color: #800000;">@"</span><span style="color: #800000;">%</span><span style="color: #800000;">"</span> identified by <span style="color: #800000;">"</span><span style="color: #800000;">abc</span><span style="color: #800000;">"</span>;</pre>

<p></p><p>其中all privileges表示查询，插入，修改，删除的权限：select,insert,update,delete</p><p></p>
<p></p><p>以上命令等价于：</p><p></p>
<pre>grant <span style="color: #0000ff;">select</span>,insert,update,delete on *.* to test1<span style="color: #800000;">@"</span><span style="color: #800000;">%</span><span style="color: #800000;">"</span> identified by <span style="color: #800000;">"</span><span style="color: #800000;">abc</span><span style="color: #800000;">"</span>;</pre>

<p></p><p>然后刷新权限</p><p></p>
<pre>flush privileges;</pre>

<p></p><p>&nbsp;(2)比如：授权本地主机上的用户操作数据库的权限</p><p></p>
<p></p><p><span style="color: #ff0000;">创建数据库</span>(比如：openfire)</p><p></p>
<pre>create database openfire;</pre>

<p></p><p>授予本地主机用户（用户名：test2，密码：123）访问数据库(数据库名称：openfire)的操作权限</p><p></p>
<pre>grant all privileges on openfire.* to test2@localhost identified by <span style="color: #800000;">"</span><span style="color: #800000;">123</span><span style="color: #800000;">"</span>;</pre>

<pre>flush privileges;</pre>

<p></p><p>&nbsp;之后，就可以用新的用户，访问openfire数据库了</p><p></p>
<p></p><p>2.更新指定帐户的密码（用户名：test1，新密码：1234）</p><p></p>
<pre>update mysql.user set password=password(<span style="color: #800000;">'</span><span style="color: #800000;">1234</span><span style="color: #800000;">'</span>) where User=<span style="color: #800000;">"</span><span style="color: #800000;">test1</span><span style="color: #800000;">"</span> and Host=<span style="color: #800000;">"</span><span style="color: #800000;">localhost</span><span style="color: #800000;">"</span>;</pre>

<p></p><p>&nbsp;3.删除用户</p><p></p>
<p></p><p>先使用mysql数据库</p><p></p>
<pre>use mysql;</pre>

<p></p><p>删除mysql数据库中user表中的某个本地用户（test7）</p><p></p>
<pre>delete from user where User=<span style="color: #800000;">"</span><span style="color: #800000;">test7</span><span style="color: #800000;">"</span> and Host=<span style="color: #800000;">"</span><span style="color: #800000;">localhost</span><span style="color: #800000;">"</span>;</pre>

<p></p><p>&nbsp;4.显示命令</p><p></p>
<p></p><p>（1）显示所有数据库列表</p><p></p>
<pre>show databases;</pre>

<p></p><p>初始化只有两个数据库，mysql和test</p><p></p>
<p></p><p><span>注意：MYSQL的系统信息都存储在mysql库中，比如：修改密码和新增用户，实际上就是用这个库进行操作</span></p><p></p>
<p></p><p><span>（2）打开某个数据库(比如数据库：openfire)</span></p><p></p>
<pre>use openfire;</pre>

<p></p><p>（3）显示本库中的所有表</p><p></p>
<pre>show tables;</pre>

<p></p><p>（4）显示某表（table1）的结构</p><p></p>
<pre>describe table1;</pre>

<p></p><p>（5）建库</p><p></p>
<pre>create database 库名;</pre>

<p></p><p>（6）建表</p><p></p>
<pre><span style="color: #000000;">use 库名；
create table 表名 (字段设定列表);</span></pre>

<p></p><p>（7）删库</p><p></p>
<pre>drop database 库名;</pre>

<p></p><p>（8）删表</p><p></p>
<pre>drop table 表名;</pre>

<p></p><p>（9）将表中的记录清空</p><p></p>
<pre>delete from 表名;</pre>

<p></p><p>（10）显示表中的记录</p><p></p>
<pre><span style="color: #0000ff;">select</span> * from 表名;</pre>

<p></p><p>六、退出mysql</p><p></p>
<pre>exit</pre>

<p></p><p>&nbsp;七、启动和停止MySQL<span style="font-size: 14px; line-height: 1.5;">&nbsp;</span></p><p></p>
<p></p><p>启动</p><p></p>
<pre>/usr/local/mysql/share/mysql.server start</pre>

<p></p><p>停止</p><p></p>
<pre>/usr/local/mysql/bin/mysqladmin -u root -p shutdown</pre>

<p></p><p>输入root密码</p><p></p>
<p></p><p><strong>安装openfire</strong></p><p></p>
<p></p><p>到<a href="http://www.igniterealtime.org/downloads/index.jsp" target="_blank" rel="external">http://www.igniterealtime.org/downloads/index.jsp</a>下载对应的openfire安装包</p><p></p>
<p></p><p>设置主机的访问ip地址</p><br><img src="/img/openfire1.png" alt="">  <p></p>
<p></p><p>数据库url设置为:<strong>jdbc:mysql://localhost:3306/openfire?useUnicode=true&amp;characterEncoding=UTF-8&amp;characterSetResults=UTF-8</strong></p><p></p>
<p></p><p><strong>导入openfire数据库表</strong></p><p></p>
<p></p><p>先修改读取权限sudo chmod 777 /usr/local/openfire</p><p></p>
<p></p><p>&lt;2&gt;在终端中，登陆MySQL</p><p></p>
<pre>mysql -u root -p</pre>

<p></p><p>然后输入数据库的root密码</p><p></p>
<p></p><p>&lt;3&gt;创建数据库openfire</p><p></p>
<pre>create database openfire;</pre>

<p></p><p>&lt;4&gt;导入openfire资源文件夹<span>&nbsp;</span><tt>resources/database下的数据表</tt>在导入前修改/usr/local/openfire/resources/database/openfire_mysql.sql中创建ofRoster的语句，把</p>
<pre>jid       VARCHAR(1024)   NOT NULL</pre>中的1024改为767<p></p>
<pre>use openfire;</pre>
<pre>source /usr/local/openfire/resources/database/openfire_mysql.sql</pre>

<p></p><p>&nbsp;在终端出现一排导入过程</p><p></p>
<p></p><p>&nbsp;&lt;5&gt;刷新权限</p><p></p>
<pre>flush privileges;</pre>

<p></p><p>&lt;6&gt;退出MySQL</p><p></p>
<pre>exit</pre>

<p></p><p>（4）用户名和密码</p><p></p>
<p></p><p>这里的用户名密码，是访问MySQL数据库时使用的帐号：root，和安装MySQL设置的root密码</p><p></p>
<p></p><p>5.特性设置</p><p></p>
<p></p><p>如果不打算使用LDAP，则保持默认设置</p><br><img src="/img/openfire2.png" alt="">  <p></p>
<p></p><p>&nbsp;6.设置openfire服务器管理员的帐号和密码</p><p></p>
<p></p><p>可以随便填写一个管理员邮箱，输入要设置的密码</p><p></p>
<p></p><p>完成注册</p><p></p>
<p></p><p>&nbsp;</p><p></p>
<p></p><p><span style="font-size: 14px; line-height: 1.5;">7.登陆管理控制台</span></p><p></p>
<p></p><p>&nbsp;</p><p></p>
<p></p><p>默认的管理员帐号是&ldquo;admin&rdquo;，默认管理员密码&ldquo;admin&rdquo;，如果上面设置了新密码，则管理员密码是新密码</p><p></p>
<p></p><p>&nbsp;</p><p></p>
<p></p><p>&nbsp;</p><p></p>
<p></p><p>如果想去掉默认的admin帐号，并自定义，需要如下操作</p><p></p>
<p></p><p>&nbsp;</p><p></p>
<p></p><p>（1）在终端中，登陆具体的数据库（openfire）</p><p></p>
<p></p><p>&nbsp;</p><p></p>
<pre>mysql -u root -p openfire</pre>

<p></p><p>&nbsp;</p><p></p>
<p></p><p>然后输入数据库的root密码</p><p></p>
<p></p><p>&nbsp;</p><p></p>
<p></p><p>（2）删除表&ldquo;ofUser&rdquo;中的admin帐户</p><p></p>
<p></p><p>&nbsp;</p><p></p>
<pre>delete from ofUser where username=<span>'</span><span>admin</span><span>'</span>;</pre>

<p></p><p>&nbsp;</p><p></p>
<p></p><p>（3）创建自定义管理员（用户名：user1，密码：123）</p><p></p>
<p></p><p>&nbsp;</p><p></p>
<pre>INSERT INTO ofUser (username, plainPassword, encryptedPassword, name, email, creationDate, modificationDate) VALUES (<span>'</span><span>user1</span><span>'</span>,<span>'</span><span>123',</span><span>'</span><span>123</span><span>'</span><span>,</span><span>'</span>Administrator<span>'</span><span>,</span><span>'</span>user1@sunyard.com<span>'</span><span>,</span><span>'</span><span>0</span><span>'</span><span>,</span><span>'</span><span>0</span><span>'</span><span>);</span></pre>

<p></p><p>&nbsp; 注意：如果重设了用户名，必须重启openfire服务器</p><p></p>
<p></p><p>三、卸载openfire</p><p></p>
<p></p><p>1.停止服务</p><p></p>
<p></p><p>在系统偏好设置的其他里，打开openfire偏好设置</p><p></p>
<p></p><p>点击Stop Openfire按钮，停止服务</p><p></p>
<p></p><p>2.删除文件</p><p></p>
<p></p><p>打开终端，输入以下命令</p><p></p>
<pre><span style="color: #0000ff;">sudo</span> <span style="color: #0000ff;">rm</span> -rf /Library/PreferencePanes/Openfire.prefPane</pre>

<pre><span style="color: #0000ff;">sudo</span> <span style="color: #0000ff;">rm</span> -rf /usr/local/openfire</pre>

<pre><span style="color: #0000ff;">sudo</span> <span style="color: #0000ff;">rm</span> -rf /Library/LaunchDaemons/org.jivesoftware.openfire.plist</pre>

<p></p><p>其中第一条命令之后，需要输入本机管理员密码</p><div id="MySignature"><p></p>
</div>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-04-18T03:10:55.000Z"><a href="/2014/04/18/IOS/thread-safety/">Apr 18 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/04/18/IOS/thread-safety/">Thread Safety</a></h1>
  

    </header>
    <div class="entry">
      
        <p><br>from: <a href="http://www.objc.io/issue-2/thread-safe-class-design.html" target="_blank" rel="external">http://www.objc.io/issue-2/thread-safe-class-design.html</a><br></p><p><br> </p><p>This article will focus on <em>practical</em> tips, design patterns, and anti-patterns with regard to writing thread-safe classes and using Grand Central Dispatch (GCD).</p>

<h2 id="thread_safety">Thread Safety</h2>

<h3 id="apples_frameworks">Apple&#8217;s Frameworks</h3>

<p>First, let&#8217;s have a look at Apple&#8217;s frameworks. In general, unless declared otherwise, most classes are not thread-safe by default. For some this is expected; for others it&#8217;s quite interesting.</p>

<p>One of the most common mistakes even experienced iOS/Mac developers make is accessing parts of UIKit/AppKit on background threads. It&#8217;s very easy to make the mistake of setting properties like <code>image</code> from a background thread, because their content is being requested from the network in the background anyway. Apple&#8217;s code is performance-optimized and will not warn you if you change properties from different threads.</p>

<p>In the case of an image, a common symptom is that your change is picked up with a delay. But if two threads set the image at the same time, it&#8217;s likely that your app will simply crash, because the currently set image could be released twice. Since this is timing dependent, it usually will crash when used by your customers and not during development.</p>

<p>There are no <em>official</em> tools to find such errors, but there are some tricks that will do the job just fine. The <a href="https://gist.github.com/steipete/5664345" target="_blank" rel="external">UIKit Main Thread Guard</a> is a small source file that will patch any calls to UIView&#8217;s <code>setNeedsLayout</code> and <code>setNeedsDisplay</code> and check for being executed on the main thread before forwarding the call. Since these two methods are called for a lot of UIKit setters (including image), this will catch many thread-related mistakes. Although this trick does not use private API, we don&#8217;t recommend using this in production apps &#8211; it&#8217;s great during development though.</p>

<p>It&#8217;s a conscious design decision from Apple&#8217;s side to not have UIKit be thread-safe. Making it thread-safe wouldn&#8217;t buy you much in terms of performance; it would in fact make many things slower. And the fact that UIKit is tied to the main thread makes it very easy to write concurrent programs and use UIKit. All you have to do is make sure that calls into UIKit are always made on the main thread.</p>

<h4 id="why_isnt_uikit_thread_safe">Why Isn&#8217;t UIKit Thread Safe?</h4>

<p>Ensuring thread safety for a big framework like UIKit would be a major undertaking and would come at a great cost. Changing non-atomic to atomic properties would only be a tiny part of the changes required. Usually you want to change several properties at once, and only then see the changed result. For this, Apple would have to expose a method much like CoreData&#8217;s <code>performBlock:</code> and <code>performBlockAndWait:</code> to synchronize changes. And if you consider that most calls to UIKit classes are about <em>configuration</em>, it&#8217;s even more pointless to make them thread-safe.</p>

<p>However, even calls that are not about configuration shared internal state and thus weren&#8217;t thread-safe. If you already wrote apps back in the dark ages of iOS3.2 and before, you surely experienced random crashes when using NSString&#8217;s <code>drawInRect:withFont:</code> while preparing background images. Thankfully, with iOS4, <a href="http://developer.apple.com/library/ios/#releasenotes/General/WhatsNewIniOS/Articles/iPhoneOS4.html" target="_blank" rel="external">Apple made most drawing methods and classes like <code>UIColor</code> and <code>UIFont</code> usable on background threads</a>.</p>

<p>Unfortunately, Apple&#8217;s documentation is lacking on the subject of thread safety. They recommend access on the main thread only, and even for drawing methods they don&#8217;t explicitly guarantee thread safety - so it&#8217;s always a good idea to read the <a href="http://developer.apple.com/library/ios/#releasenotes/General/WhatsNewIniOS/Articles/iPhoneOS4.html" target="_blank" rel="external">iOS Release Notes</a> as well.</p>

<p>For the most part, UIKit classes should be used only from the application’s main thread. This is particularly true either for classes derived from UIResponder or those that involve manipulating your application’s user interface in any way.</p>

<h4 id="the_deallocation_problem">The Deallocation Problem</h4>

<p>Another danger when using UIKit objects in the background is called &#8220;The Deallocation Problem.&#8221; Apple outlines the issue in <a href="http://developer.apple.com/library/ios/#technotes/tn2109/_index.html" target="_blank" rel="external">TN2109</a> and presents various solutions. The problem is that UI objects should be deallocated on the main thread, because some of them might perform changes to the view hierarchy in <code>dealloc</code>. As we know, such calls to UIKit need to happen on the main thread.</p>

<p>Since it&#8217;s common that a secondary thread, operation, or block retains the caller, this is very easy to get wrong and quite hard to find/fix. This was also <a href="https://github.com/AFNetworking/AFNetworking/issues/56" target="_blank" rel="external">a long-standing bug in AFNetworking</a>, simply because not a lot of people know about this issue and &#8211; as usual &#8211; it manifests itself in rare, hard-to-reproduce crashes. Consistent use of __weak and not accessing ivars in async blocks/operations helps.</p>

<h4 id="collection_classes">Collection Classes</h4>

<p>Apple has a good overview document for both <a href="https://developer.apple.com/library/ios/#documentation/Cocoa/Conceptual/Multithreading/ThreadSafetySummary/ThreadSafetySummary.html#//apple_ref/doc/uid/10000057i-CH12-SW1" target="_blank" rel="external">iOS and Mac</a> listing thread safety for the most common foundation classes. In general, immutable classes like <code>NSArray</code> are thread-safe, while their mutable variants like <code>NSMutableArray</code> are not. In fact, it&#8217;s fine to use them from different threads, as long as access is serialized within a queue. Remember that methods might return a mutable variant of a collection object even if they declare their return type as immutable. It&#8217;s good practice to write something like <code>return [array copy]</code> to ensure the returned object is in fact immutable.</p>

<p>Unlike in languages like <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ConcurrentHashMap.html" target="_blank" rel="external">Java</a>, the Foundation framework doesn&#8217;t offer thread-safe collection classes out of the box. This is actually very reasonable, because in most cases you want to apply your locks higher up anyway to avoid too many locking operations. A notable exception are caches, where a mutable dictionary might hold immutable data &#8211; here Apple added <code>NSCache</code> in iOS4 that not only locks access, but also purges its content in low-memory situations.</p>

<p>That said, there might be valid cases in your application where a thread-safe, mutable dictionary can be handy. And thanks to the class cluster approach, <a href="https://gist.github.com/steipete/5928916" target="_blank" rel="external">it&#8217;s easy to write one</a>.</p>

<h3 id="atomic_properties">Atomic Properties</h3>

<p>Ever wondered how Apple is handling atomic setting/getting of properties? By now you have likely heard about spinlocks, semaphores, locks, @synchronized - so what&#8217;s Apple using? Thankfully, <a href="http://www.opensource.apple.com/source/objc4/" target="_blank" rel="external">the Objective-C runtime is public</a>, so we can take a look behind the curtain.</p>

<p>A nonatomic property setter might look like this:</p>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> - (<span class="keyword">void</span>)setUserName:(<span class="built_in">NSString</span> *)userName {</div><div class="line">      <span class="keyword">if</span> (userName != _userName) {</div><div class="line">          [userName retain];</div><div class="line">          [_userName release];</div><div class="line">          _userName = userName;</div><div class="line">      }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>This is the variant with manual retain/release; however, the ARC-generated code looks similar. When we look at this code it&#8217;s obvious why this means trouble when <code>setUserName:</code> is called concurrently. We could end up releasing <code>_userName</code> twice, which can corrupt memory and lead to hard-to-find bugs.</p>

<p>What&#8217;s happening internally for any property that&#8217;s not manually implemented is that the compiler generates a call to <a href="https://github.com/opensource-apple/objc4/blob/master/runtime/Accessors.subproj/objc-accessors.mm#L127" target="_blank" rel="external"><code>objc_setProperty_non_gc(id self, SEL _cmd, ptrdiff_t offset, id newValue, BOOL atomic, signed char shouldCopy)</code></a>. In our example, the call parameters would look like this:</p>

<pre><code>objc_setProperty_non_gc(self, _cmd, 
  (ptrdiff_t)(&amp;_userName) - (ptrdiff_t)(self), userName, NO, NO);`</code></pre>

<p>The ptrdiff_t might look weird to you, but in the end it&#8217;s simple pointer arithmetic, since an Objective-C class is just another C struct.</p>

<p><code>objc_setProperty</code> calls down to following method:</p>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"> </div><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> reallySetProperty(<span class="keyword">id</span> <span class="keyword">self</span>, SEL _cmd, <span class="keyword">id</span> newValue, </div><div class="line">  ptrdiff_t offset, <span class="keyword">bool</span> atomic, <span class="keyword">bool</span> <span class="keyword">copy</span>, <span class="keyword">bool</span> mutableCopy) </div><div class="line">{</div><div class="line">    <span class="keyword">id</span> oldValue;</div><div class="line">    <span class="keyword">id</span> *slot = (<span class="keyword">id</span>*) ((<span class="keyword">char</span>*)<span class="keyword">self</span> + offset);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">copy</span>) {</div><div class="line">        newValue = [newValue copyWithZone:<span class="literal">NULL</span>];</div><div class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (mutableCopy) {</div><div class="line">        newValue = [newValue mutableCopyWithZone:<span class="literal">NULL</span>];</div><div class="line">    } <span class="keyword">else</span> {</div><div class="line">        <span class="keyword">if</span> (*slot == newValue) <span class="keyword">return</span>;</div><div class="line">        newValue = objc_retain(newValue);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!atomic) {</div><div class="line">        oldValue = *slot;</div><div class="line">        *slot = newValue;</div><div class="line">    } <span class="keyword">else</span> {</div><div class="line">        spin_lock_t *slotlock = &amp;amp;PropertyLocks[GOODHASH(slot)];</div><div class="line">        _spin_lock(slotlock);</div><div class="line">        oldValue = *slot;</div><div class="line">        *slot = newValue;        </div><div class="line">        _spin_unlock(slotlock);</div><div class="line">    }</div><div class="line"></div><div class="line">    objc_release(oldValue);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>Aside from the rather funny name, this method is actually fairly straightforward and uses one of the 128 available spinlocks in <code>PropertyLocks</code>. This is a pragmatic and fast approach &#8211; the worst case scenario is that a setter might have to wait for an unrelated setter to finish because of a hash collision.</p>

<p>While those methods aren&#8217;t declared in any public header, it is possible to call them manually. I&#8217;m not saying this is a good idea, but it&#8217;s interesting to know and could be quite useful if you want atomic properties <em>and</em> to implement the setter at the same time.</p>

<pre><code>// Manually declare runtime methods.
extern void objc_setProperty(id self, SEL _cmd, ptrdiff_t offset, 
  id newValue, BOOL atomic, BOOL shouldCopy);
extern id objc_getProperty(id self, SEL _cmd, ptrdiff_t offset, 
  BOOL atomic);

#define PSTAtomicRetainedSet(dest, src) objc_setProperty(self, _cmd, 
  (ptrdiff_t)(&amp;dest) - (ptrdiff_t)(self), src, YES, NO) 
#define PSTAtomicAutoreleasedGet(src) objc_getProperty(self, _cmd, 
  (ptrdiff_t)(&amp;src) - (ptrdiff_t)(self), YES)</code></pre>

<p><a href="https://gist.github.com/steipete/5928690" target="_blank" rel="external">Refer to this gist</a> for the full snippet including code to handle structs. But keep in mind that we don&#8217;t recommend using this.</p>

<h4 id="what_about_synchronized">What about @synchronized?</h4>

<p>You might be curious why Apple isn&#8217;t using <code>@synchronized(self)</code> for property locking, an already existing runtime feature. Once you <a href="https://github.com/opensource-apple/objc4/blob/master/runtime/objc-sync.mm#L291" target="_blank" rel="external">look at the source</a>, you&#8217;ll see that there&#8217;s a lot more going on. Apple is using <a href="http://googlemac.blogspot.co.at/2006/10/synchronized-swimming.html" target="_blank" rel="external">up to three lock/unlock sequences</a>, partly because they also add <a href="https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/Multithreading/ThreadSafety/ThreadSafety.html#//apple_ref/doc/uid/10000057i-CH8-SW3" target="_blank" rel="external">exception unwinding</a>. This would be a slowdown compared to the much faster spinlock approach. Since setting the property usually is quite fast, spinlocks are perfect for the job. <code>@synchonized(self)</code> is good when you need to ensure that exception can be thrown without the code deadlocking.</p>

<h3 id="your_own_classes">Your Own Classes</h3>

<p>Using atomic properties alone won&#8217;t make your classes thread-safe. It will only protect you against <a href="/issue-2/concurrency-apis-and-pitfalls.html#shared_resources">race conditions</a> in the setter, but won&#8217;t protect your application logic. Consider the following snippet:</p>

<pre><code>if (self.contents) {
    CFAttributedStringRef stringRef = CFAttributedStringCreate(NULL, 
      (__bridge CFStringRef)self.contents, NULL);
    // draw string
}</code></pre>

<p>I&#8217;ve made this mistake early on in <a href="http://pspdfkit.com" target="_blank" rel="external">PSPDFKit</a>. From time to time, the application crashed with a EXC_BAD_ACCESS, when the <code>contents</code> property was set to nil after the check. A simple fix for this issue would be to capture the variable:</p>

<pre><code>NSString *contents = self.contents;
if (contents) {
    CFAttributedStringRef stringRef = CFAttributedStringCreate(NULL, 
      (__bridge CFStringRef)contents, NULL);
    // draw string
}</code></pre>

<p>This would solve the issue here, but in most cases it&#8217;s not that simple. Imagine that we also have a <code>textColor</code> property and we change both properties on one thread. Then our render thread could end up using the new content along with the old color value and we get a weird combination. This is one reason why Core Data binds model objects to one thread or queue.</p>

<p>There&#8217;s no one-size-fits-all solution for this problem. Using <a href="http://www.cocoawithlove.com/2008/04/value-of-immutable-values.html" target="_blank" rel="external">immutable models</a> is a solution, but it has its own problems. Another way is to limit changes to existing objects to the main thread or a specific queue and to generate copies before using them on worker threads. I recommend Jonathan Sterling&#8217;s article about <a href="http://www.jonmsterling.com/posts/2012-12-27-a-pattern-for-immutability.html" target="_blank" rel="external">Lightweight Immutability in Objective-C</a> for even more ideas on solving this problem.</p>

<p>The simple solution is to use @synchronize. Anything else is very, very likely to get you into trouble. Way smarter people have failed again and again at doing so.</p>

<h4 id="practical_threadsafe_design">Practical Thread-Safe Design</h4>

<p>Before trying to make something thread-safe, think hard if it&#8217;s necessary. Make sure it&#8217;s not premature optimization. If it&#8217;s anything like a configuration class, there&#8217;s no point in thinking about thread safety. A much better approach is to throw some asserts in to ensure it&#8217;s used correctly:</p>

<pre><code>void PSPDFAssertIfNotMainThread(void) {
    NSAssert(NSThread.isMainThread, 
      @&quot;Error: Method needs to be called on the main thread. %@&quot;, 
      [NSThread callStackSymbols]);
}</code></pre>

<p>Now there&#8217;s code that definitely should be thread-safe; a good example is a caching class. A good approach is to use a concurrent dispatch_queue as read/write lock to maximize performance and try to only lock the areas that are really necessary. Once you start using multiple queues for locking different parts, things get tricky really fast.</p>

<p>Sometimes you can also rewrite your code so that special locks are not required. Consider this snippet that is a form of a multicast delegate. (In many cases, using NSNotifications would be better, but there are <a href="https://code.google.com/r/riky-adsfasfasf/source/browse/Utilities/GCDMulticastDelegate.h" target="_blank" rel="external">valid use cases for multicast delegates.</a>)</p>

<pre><code>// header
@property (nonatomic, strong) NSMutableSet *delegates;

// in init
_delegateQueue = dispatch_queue_create(&quot;com.PSPDFKit.cacheDelegateQueue&quot;, 
  DISPATCH_QUEUE_CONCURRENT);

- (void)addDelegate:(id&lt;PSPDFCacheDelegate&gt;)delegate {
    dispatch_barrier_async(_delegateQueue, ^{
        [self.delegates addObject:delegate];
    });
}

- (void)removeAllDelegates {
    dispatch_barrier_async(_delegateQueue, ^{
        self.delegates removeAllObjects];
    });
}

- (void)callDelegateForX {
    dispatch_sync(_delegateQueue, ^{
        [self.delegates enumerateObjectsUsingBlock:^(id&lt;PSPDFCacheDelegate&gt; delegate, NSUInteger idx, BOOL *stop) {
            // Call delegate
        }];
    });
}</code></pre>

<p>Unless <code>addDelegate:</code> or <code>removeDelegate:</code> is called thousand times per second, a simpler and cleaner approach is the following:</p>

<pre><code>// header
@property (atomic, copy) NSSet *delegates;

- (void)addDelegate:(id&lt;PSPDFCacheDelegate&gt;)delegate {
    @synchronized(self) {
        self.delegates = [self.delegates setByAddingObject:delegate];
    }
}

- (void)removeAllDelegates {
    self.delegates = nil;
}

- (void)callDelegateForX {
    [self.delegates enumerateObjectsUsingBlock:^(id&lt;PSPDFCacheDelegate&gt; delegate, NSUInteger idx, BOOL *stop) {
        // Call delegate
    }];
}</code></pre>

<p>Granted, this example is a bit constructed and one could simply confine changes to the main thread. But for many data structures, it might be worth it to create immutable copies in the modifier methods, so that the general application logic doesn&#8217;t have to deal with excessive locking. Notice how we still have to apply locking in <code>addDelegate:</code>, since otherwise delegate objects might get lost if called from different threads concurrently.</p>

<h2 id="pitfalls_of_gcd">Pitfalls of GCD</h2>

<p>For most of your locking needs, GCD is perfect. It&#8217;s simple, it&#8217;s fast, and its block-based API makes it much harder to accidentally do imbalanced locks. However, there are quite a few pitfalls, some of which we are going to explore here.</p>

<h3 id="using_gcd_as_a_recursive_lock">Using GCD as a Recursive Lock</h3>

<p>GCD is a queue to serialize access to shared resources. This can be used for locking, but it&#8217;s quite different than <code>@synchronized</code>. GCD queues are not reentrant - this would break the queue characteristics. Many people tried working around this with using <code>dispatch_get_current_queue()</code>, which is <a href="https://gist.github.com/steipete/3713233" target="_blank" rel="external">a bad idea</a>, and Apple had its reasons for deprecating this method in iOS6.</p>

<pre><code>// This is a bad idea.
inline void pst_dispatch_sync_reentrant(dispatch_queue_t queue, 
  dispatch_block_t block) 
{
    dispatch_get_current_queue() == queue ? block() 
                                          : dispatch_sync(queue, block);
}</code></pre>

<p>Testing for the current queue might work for simple solutions, but it fails as soon as your code gets more complex, and you might have multiple queues locked at the same time. Once you are there, you almost certainly will get a <a href="/issue-2/concurrency-apis-and-pitfalls.html#dead_locks">deadlock</a>. Sure, one could use <code>dispatch_get_specific()</code>, which will traverse the whole queue hierarchy to test for specific queues. For that you would have to write custom queue constructors that apply this metadata. Don&#8217;t go that way. There are use cases where a <code>NSRecursiveLock</code> is the better solution.</p>

<h3 id="fixing_timing_issues_with_dispatch_async">Fixing Timing Issues with dispatch_async</h3>

<p>Having some timing-issues in UIKit? Most of the time, this will be the perfect &#8220;fix:&#8221;</p>

<pre><code>dispatch_async(dispatch_get_main_queue(), ^{
    // Some UIKit call that had timing issues but works fine 
    // in the next runloop.
    [self updatePopoverSize];
});</code></pre>

<p>Don&#8217;t do this, trust me. This will haunt you later as your app gets larger. It&#8217;s super hard to debug and soon things will fall apart when you need to dispatch more and more because of &#8220;timing issues.&#8221; Look through your code and find the proper place for the call (e.g. viewWillAppear instead of viewDidLoad). I still have some of those hacks in my codebase, but most of them are properly documented and an issue is filed.</p>

<p>Remember that this isn&#8217;t really GCD-specific, but it&#8217;s a common anti-pattern and just very easy to do with GCD. You can apply the same wisdom for <code>performSelector:afterDelay:</code>, where the delay is 0.f for the next runloop.</p>

<h3 id="mixing_dispatch_sync_and_dispatch_async_in_performance_critical_code">Mixing dispatch_sync and dispatch_async in Performance Critical Code</h3>

<p>That one took me a while to figure out. In <a href="http://pspdfkit.com" target="_blank" rel="external">PSPDFKit</a> there is a caching class that uses a LRU list to track image access. When you scroll through the pages, this is called <em>a lot</em>. The initial implementation used dispatch_sync for availability access, and dispatch_async to update the LRU position. This resulted in a frame rate far from the goal of 60 FPS.</p>

<p>When other code running in your app is blocking GCD&#8217;s threads, it might take a while until the dispatch manager finds a thread to perform the dispatch_async code &#8211; until then, your sync call will be blocked. Even when, as in this example, the order of execution for the async case isn&#8217;t important, there&#8217;s no easy way to tell that to GCD. Read/Write locks won&#8217;t help you there, since the async process most definitely needs to perform a barrier write and all your readers will be locked during that. Lesson: <code>dispatch_async</code> can be expensive if it&#8217;s misused. Be careful when using it for locking.</p>

<h3 id="using_dispatch_async_to_dispatch_memoryintensive_operations">Using dispatch_async to Dispatch Memory-Intensive Operations</h3>

<p>We already talked a lot about NSOperations, and that it&#8217;s usually a good idea to use the more high-level API. This is especially true if you deal with blocks of work that do memory-intensive operations.</p>

<p>In an old version of PSPDFKit, I used a GCD queue to dispatch writing cached JPG images to disk. When the retina iPad came out, this started causing trouble. The resolution doubled, and it took much longer to encode the image data than it took to render it. Consequently, operations piled up in the queue and when the system was busy it could crash of memory exhaustion.</p>

<p>There&#8217;s no way to see how many operations are queued (unless you manually add code to track this), and there&#8217;s also no built-in way to cancel operations in case of a low-memory notification. Switching to NSOperations made the code a lot more debuggable and allowed all this without writing manual management code.</p>

<p>Of course there are some caveats; for example you can&#8217;t set a target queue on your <code>NSOperationQueue</code> (like <code>DISPATCH_QUEUE_PRIORITY_BACKGROUND</code> for throttled I/O). But that&#8217;s a small price for debuggability, and it also prevents you from running into problem like <a href="/issue-2/concurrency-apis-and-pitfalls.html#priority_inversion">priority inversion</a>. I even recommend against the nice <code>NSBlockOperation</code> API and suggest real subclasses of NSOperation, including an implementation of description. It&#8217;s more work, but later on, having a way to print all running/pending operations is insanely useful.</p>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-04-10T06:32:55.000Z"><a href="/2014/04/10/IOS/runtime/">Apr 10 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/04/10/IOS/runtime/">runtime</a></h1>
  

    </header>
    <div class="entry">
      
        <p></p><p><br>关联对象<br></p><p></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">void</span> *alertKey = <span class="string">"alertKey"</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span> (^Block)(<span class="keyword">int</span>);</div><div class="line"></div><div class="line">UIAlertView *alert = [[UIAlertView alloc] initWithTitle:<span class="string">@""</span> message:<span class="string">@"test"</span> delegate:<span class="keyword">self</span> cancelButtonTitle:<span class="string">@"取消"</span> otherButtonTitles:<span class="string">@"确定"</span>, <span class="literal">nil</span>];</div><div class="line">  </div><div class="line">    </div><div class="line">      Block block  = ^(<span class="built_in">NSInteger</span> index ){</div><div class="line">        <span class="keyword">if</span> (index == <span class="number">0</span>)</div><div class="line">        {</div><div class="line">          <span class="built_in">NSLog</span>(<span class="string">@"1"</span>);</div><div class="line">        }</div><div class="line">        <span class="keyword">else</span></div><div class="line">        {</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"2"</span>);</div><div class="line">        }</div><div class="line">    };</div><div class="line"></div><div class="line">    objc_setAssociatedObject(alert, alertKey, block, OBJC_ASSOCIATION_COPY);</div><div class="line">    [alert show];</div><div class="line">    </div><div class="line">    </div></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)alertView:(UIAlertView *)alertView clickedButtonAtIndex:(<span class="built_in">NSInteger</span>)buttonIndex</div><div class="line">{</div><div class="line">     Block block = objc_getAssociatedObject(alertView, alertKey);</div><div class="line">    block(buttonIndex);</div><div class="line">}</div></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-03-05T02:08:49.000Z"><a href="/2014/03/05/IOS/nslayoutconstraint/">Mar 5 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/03/05/IOS/nslayoutconstraint/">NSLayoutConstraint</a></h1>
  

    </header>
    <div class="entry">
      
        <p></p><p><br>ios6之后开始使用自动约束布局NSLayoutConstraint，这个可以解决对于不同的ios设备、autoresizingMask的不足。<br></p><br> <figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad</div><div class="line">{</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    _originV = [[<span class="built_in">UIView</span> alloc] init];</div><div class="line">    _originV<span class="variable">.backgroundColor</span> = [<span class="built_in">UIColor</span> redColor];</div><div class="line">    _originV<span class="variable">.translatesAutoresizingMaskIntoConstraints</span> = <span class="literal">NO</span>;</div><div class="line">    [<span class="keyword">self</span><span class="variable">.view</span> addSubview:_originV];</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span><span class="variable">.view</span> addConstraint:[NSLayoutConstraint constraintWithItem:_originV attribute:NSLayoutAttributeWidth relatedBy:NSLayoutRelationEqual  toItem:<span class="keyword">self</span><span class="variable">.view</span> attribute:NSLayoutAttributeWidth multiplier:<span class="number">1</span> constant:-<span class="number">40</span>]];</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span><span class="variable">.view</span> addConstraint:[NSLayoutConstraint constraintWithItem:_originV attribute:NSLayoutAttributeHeight relatedBy:NSLayoutRelationEqual  toItem:<span class="keyword">self</span><span class="variable">.view</span> attribute:NSLayoutAttributeHeight multiplier:<span class="number">1</span> constant:-<span class="number">40</span>]];</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span><span class="variable">.view</span> addConstraint:[NSLayoutConstraint constraintWithItem:_originV attribute:NSLayoutAttributeCenterY relatedBy:NSLayoutRelationEqual  toItem:<span class="keyword">self</span><span class="variable">.view</span> attribute:NSLayoutAttributeCenterY multiplier:<span class="number">1</span> constant:<span class="number">0</span>]];</div><div class="line">    </div><div class="line">    _constran = [NSLayoutConstraint constraintWithItem:_originV attribute:NSLayoutAttributeCenterX relatedBy:NSLayoutRelationEqual toItem:<span class="keyword">self</span><span class="variable">.view</span> attribute:NSLayoutAttributeCenterX multiplier:<span class="number">1</span> constant:<span class="number">0</span>];</div><div class="line">  </div><div class="line">    [<span class="keyword">self</span><span class="variable">.view</span> addConstraint:_constran];</div><div class="line">    </div><div class="line">    _but = [<span class="built_in">UIButton</span> buttonWithType:UIButtonTypeRoundedRect];</div><div class="line">    _but<span class="variable">.backgroundColor</span> =[<span class="built_in">UIColor</span> blueColor];</div><div class="line">    _but<span class="variable">.translatesAutoresizingMaskIntoConstraints</span> = <span class="literal">NO</span>;</div><div class="line">    [_but addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(changeButton:) forControlEvents:UIControlEventTouchUpInside];</div><div class="line">    [<span class="keyword">self</span><span class="variable">.view</span> addSubview:_but];</div><div class="line">   </div><div class="line">    [<span class="keyword">self</span><span class="variable">.view</span> addConstraint:[NSLayoutConstraint constraintWithItem:_but attribute:NSLayoutAttributeLeft relatedBy:NSLayoutRelationEqual toItem:_originV attribute:NSLayoutAttributeLeft multiplier:<span class="number">1</span> constant:<span class="number">30</span>]];</div><div class="line">    </div><div class="line">      [<span class="keyword">self</span><span class="variable">.view</span> addConstraint:[NSLayoutConstraint constraintWithItem:_but attribute:NSLayoutAttributeTop relatedBy:NSLayoutRelationEqual toItem:_originV attribute:NSLayoutAttributeTop multiplier:<span class="number">1</span> constant:<span class="number">30</span>]];</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span><span class="variable">.view</span> addConstraint:[NSLayoutConstraint constraintWithItem:_but attribute:NSLayoutAttributeRight relatedBy:NSLayoutRelationEqual toItem:_originV attribute:NSLayoutAttributeRight multiplier:<span class="number">1</span> constant: -<span class="number">30</span>]];</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span><span class="variable">.view</span> addConstraint:[NSLayoutConstraint constraintWithItem:_but attribute:NSLayoutAttributeBottom relatedBy:NSLayoutRelationEqual toItem:_originV attribute:NSLayoutAttributeBottom multiplier:<span class="number">1</span> constant:-<span class="number">30</span>]];</div><div class="line">}</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)changeButton:(<span class="built_in">UIButton</span> *)button</div><div class="line">{</div><div class="line">    _constran<span class="variable">.constant</span> += <span class="number">5</span>;</div><div class="line">    [<span class="keyword">self</span><span class="variable">.view</span> updateConstraintsIfNeeded];</div><div class="line">}</div><div class="line"> </div></pre></td></tr></table></figure><p></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-03-03T03:56:50.000Z"><a href="/2014/03/03/IOS/多参数函数/">Mar 3 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/03/03/IOS/多参数函数/">多参数函数</a></h1>
  

    </header>
    <div class="entry">
      
        <figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)method:(<span class="built_in">NSString</span> *)arg,...</div><div class="line">{</div><div class="line">    va_list list;</div><div class="line">    va_start(list, arg);</div><div class="line">    <span class="keyword">while</span> (<span class="literal">YES</span>)</div><div class="line">    {</div><div class="line">        <span class="built_in">NSString</span> *value = va_arg(list, <span class="built_in">NSString</span>*);</div><div class="line">        <span class="keyword">if</span> (value)</div><div class="line">        {</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"value %@"</span>,value);</div><div class="line">        }</div><div class="line">        <span class="keyword">else</span></div><div class="line">        {</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line">    va_end(list);</div><div class="line">}</div></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-02-13T04:22:16.000Z"><a href="/2014/02/13/IOS/使用adobe-acrobat-pro查看pdf的文件结构/">Feb 13 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/02/13/IOS/使用adobe-acrobat-pro查看pdf的文件结构/">使用Adobe Acrobat Pro查看pdf的文件结构</a></h1>
  

    </header>
    <div class="entry">
      
        <p><img src="/img/pdf1.png" alt=""><br><img src="/img/pdf2.png" alt=""><br> <img src="/img/pdf3.png" alt="">  </p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-10-26T06:04:47.000Z"><a href="/2013/10/26/IOS/uitabbaritem-定制/">Oct 26 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/10/26/IOS/uitabbaritem-定制/">UITabbarItem 定制</a></h1>
  

    </header>
    <div class="entry">
      
        <p><br>设置item的标题颜色：<br></p><br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[[UITabBarItem appearance] setTitleTextAttributes:@{ UITextAttributeTextColor : [<span class="built_in">UIColor</span> grayColor] }</div><div class="line">                                         forState:UIControlStateNormal];</div><div class="line">[[UITabBarItem appearance] setTitleTextAttributes:@{ UITextAttributeTextColor : [<span class="built_in">UIColor</span> redColor] }</div><div class="line">                                         forState:UIControlStateSelected];</div></pre></td></tr></table></figure><br><br><p><br>设置选中和没有选中时候都图片：<br></p><br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//for ios7 before</span></div><div class="line">- (<span class="keyword">void</span>)setFinishedSelectedImage:(<span class="built_in">UIImage</span> *)selectedImage withFinishedUnselectedImage:(<span class="built_in">UIImage</span> *)unselectedImage ;</div><div class="line"></div><div class="line"><span class="comment">//for ios7 and later</span></div><div class="line"><span class="comment">//tips:设置图片的时候要用</span></div><div class="line"><span class="comment">//[[UIImage imageNamed:@"ImageName"] imageWithRenderingMode:UIImageRenderingModeAlwaysOriginal]</span></div><div class="line">- (instancetype)initWithTitle:(<span class="built_in">NSString</span> *)title image:(<span class="built_in">UIImage</span> *)image selectedImage:(<span class="built_in">UIImage</span> *)selectedImage;</div></pre></td></tr></table></figure><br><p><br>ios7 去掉默认都选中颜色<br></p>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span><span class="variable">.tabBar</span><span class="variable">.tintColor</span> = [<span class="built_in">UIColor</span> clearColor];</div></pre></td></tr></table></figure>

<p><br>ios7之前去掉选中的时候都mask方块<br></p>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//empty.png 是一张透明都png图</span></div><div class="line">     <span class="keyword">self</span><span class="variable">.tabBar</span><span class="variable">.selectionIndicatorImage</span> = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"empty.png"</span>];</div><div class="line">     <span class="keyword">self</span><span class="variable">.tabBar</span><span class="variable">.selectedImageTintColor</span> = [<span class="built_in">UIColor</span> clearColor];</div></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-10-26T06:02:18.000Z"><a href="/2013/10/26/IOS/xcode使用github/">Oct 26 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/10/26/IOS/xcode使用github/">xcode使用github</a></h1>
  

    </header>
    <div class="entry">
      
        <p><br>Xcode 中使用Github<br>第一步：为你的mac添加认证，使得它能够连接到github。<br><br>参考<a href="http://help.github.com/mac-set-up-git/" target="_blank" rel="external">http://help.github.com/mac-set-up-git/</a> 一步一步操作即可<br>====================================================================<br>第二步：新建项目<br>先在github里面添加一个Repository，通过<a href="http://github.com/首页的new" target="_blank" rel="external">http://github.com/首页的new</a> Repository连接进入，填写相关的项目信息，创建即可。创建后会跳转到初始项目界面，先暂停，在第三步再使用这个界面。<br>在mac上使用xcode新建一个项目，为项目使用git，创建过程中使用 create local git repository for this project，指定要存储的目录即可。<br>====================================================================<br>第三步：初始化提交项目<br>回到第二步github创建项目后的界面。初始化有几种方式，这里我们选择从已有仓库提交代码。执行下面的代码即可。<br>Existing Git Repo?<br>cd existing_git_repo<br>git remote add origin git@github.com:your_account/your_project.git<br>git push -u origin master<br>上面的代码将本地的仓库连接到远程仓库，并且将代码提交到master分支上。<br>====================================================================<br>第四步：提交代码<br>新建的文件，XCode会提示一个A标签，表示是added的。<br>编辑的文件，XCode会提示一个M标签，表示是Modified的。<br>选中要更新的文件，右键—&gt;Source Control—&gt;Commit Selected Files 通过此操作将变更提交到本地的仓库中。<br>选中要更新的文件，File菜单—&gt;Source Control—&gt;Push 将本地变化存储到远程服务器中。<br><br></p><br><p><br>from:<a href="http://qiufangzhou.blog.163.com/blog/static/506421802011924102515390/" target="_blank" rel="external">http://qiufangzhou.blog.163.com/blog/static/506421802011924102515390/</a><br></p>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-10-22T07:29:05.000Z"><a href="/2013/10/22/IOS/xcode-使用git/">Oct 22 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/10/22/IOS/xcode-使用git/">Xcode 使用git</a></h1>
  

    </header>
    <div class="entry">
      
        <p><br>Xcode 中使用Github<br>第一步：为你的mac添加认证，使得它能够连接到github。<br><br> 参考<a href="http://help.github.com/mac-set-up-git/" target="_blank" rel="external">http://help.github.com/mac-set-up-git/</a>  一步一步操作即可<br>====================================================================<br>第二步：新建项目<br> 先在github里面添加一个Repository，通过<a href="http://github.com/首页的new" target="_blank" rel="external">http://github.com/首页的new</a> Repository连接进入，填写相关的项目信息，创建即可。创建后会跳转到初始项目界面，先暂停，在第三步再使用这个界面。<br> 在mac上使用xcode新建一个项目，为项目使用git，创建过程中使用 create local git repository for this project，指定要存储的目录即可。<br>====================================================================<br>第三步：初始化提交项目<br> 回到第二步github创建项目后的界面。初始化有几种方式，这里我们选择从已有仓库提交代码。执行下面的代码即可。<br>  Existing Git Repo?<br>   cd existing_git_repo<br>   git remote add origin git@github.com:your_account/your_project.git<br>   git push -u origin master<br>上面的代码将本地的仓库连接到远程仓库，并且将代码提交到master分支上。<br>====================================================================<br>第四步：提交代码<br>   新建的文件，XCode会提示一个A标签，表示是added的。<br>   编辑的文件，XCode会提示一个M标签，表示是Modified的。<br>   选中要更新的文件，右键—&gt;Source Control—&gt;Commit Selected Files 通过此操作将变更提交到本地的仓库中。<br>   选中要更新的文件，File菜单—&gt;Source Control—&gt;Push 将本地变化存储到远程服务器中。<br><br>from：<a href="http://qiufangzhou.blog.163.com/blog/static/506421802011924102515390/" target="_blank" rel="external">http://qiufangzhou.blog.163.com/blog/static/506421802011924102515390/</a><br></p>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
  
    <a href="/page/2/" class="alignright next">Next</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/IOS/">IOS</a><small>44</small></li>
  
    <li><a href="/categories/OSX/">OSX</a><small>1</small></li>
  
    <li><a href="/categories/Other/">Other</a><small>4</small></li>
  
    <li><a href="/categories/windowsphone/">windowsphone</a><small>5</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/IOS/">IOS</a><small>16</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2014 virgil
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>